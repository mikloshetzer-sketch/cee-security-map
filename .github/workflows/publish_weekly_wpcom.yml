name: Publish weekly WordPress.com post

on:
  workflow_dispatch: {}
  schedule:
    # Hétfő 07:30 Budapest idő (CET/CEST) -> UTC-ban évszaktól függ,
    # ezért inkább 06:30 UTC (tél) / 05:30 UTC (nyár) közelében csúszhat.
    # Ha fix budapesti idő kell, később megoldjuk külön.
    - cron: "30 6 * * 1"

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Publish weekly post to WordPress.com
        env:
          WPCOM_CLIENT_ID: ${{ secrets.WPCOM_CLIENT_ID }}
          WPCOM_CLIENT_SECRET: ${{ secrets.WPCOM_CLIENT_SECRET }}
          WPCOM_REFRESH_TOKEN: ${{ secrets.WPCOM_REFRESH_TOKEN }}
          WPCOM_SITE: ${{ secrets.WPCOM_SITE }}
          # opcionális:
          WPCOM_POST_STATUS: ${{ secrets.WPCOM_POST_STATUS }}
          MAP_URL: ${{ secrets.MAP_URL }}
          WPCOM_TAGS: ${{ secrets.WPCOM_TAGS }}
          WPCOM_CATEGORIES: ${{ secrets.WPCOM_CATEGORIES }}
        run: |
          python scripts/publish_weekly_wpcom.py
